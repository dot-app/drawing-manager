var BMapGLLib=window.BMapGLLib=BMapGLLib||{},BMAP_DRAWING_MARKER="marker",BMAP_DRAWING_POLYLINE="polyline",BMAP_DRAWING_CIRCLE="circle",BMAP_DRAWING_RECTANGLE="rectangle",BMAP_DRAWING_POLYGON="polygon",MOBILE=!0,TAP="touchstart",TOUCH_START="touchstart",TOUCH_END="touchend",TOUCH_MOVE="touchmove";"ontouchend"in document==!1&&(MOBILE=!1,TAP="click",TOUCH_START="mousedown",TOUCH_END="mouseup",TOUCH_MOVE="mousemove"),function(){function t(t){this.type=t.type,this.point=t.point,this.overlay=t.overlay,this.DrawingManager=t.DrawingManager,this._map=t.map}function e(t,e){this.limit=t.limit,this.type=t.type,this.point=t.point,this.overlay=t.overlay,this.overlays=t.overlays,this.DrawingManager=e}function n(t,e,n,i,a){this.type=t,this.point=e,this.number=n,this.overlay=i,this.DrawingManager=a}function i(){this._enableEdgeMove=!1}function a(t,e){this.drawingManager=t,e=this.drawingToolOptions=e||{},this._opts={},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMapGL.Size(10,10),this.defaultDrawingModes=[BMAP_DRAWING_MARKER,BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYLINE,BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE],e.drawingModes?this.drawingModes=e.drawingModes:this.drawingModes=this.defaultDrawingModes,e.hasCustomStyle&&(e.anchor&&this.setAnchor(e.anchor),e.offset&&this.setOffset(e.offset))}function o(t){for(var e=u.length;e--;)u[e]!=t&&u[e].close()}function s(t,e,n){var i,a,o,s=t.lng,r=t.lat,l=e/6378800,p=Math.PI/180*r,d=Math.PI/180*s;switch(n){case"North":case"north":case"N":case"n":i=0,a=t.lng;break;case"West":case"west":case"W":case"w":i=90,o=t.lat;break;case"South":case"south":case"S":case"s":i=180,a=t.lng;break;case"East":case"east":case"E":case"e":i=270,o=t.lat;break;default:i=~~n}var c=Math.PI/180*i,h=Math.asin(Math.sin(p)*Math.cos(l)+Math.cos(p)*Math.sin(l)*Math.cos(c)),g=Math.atan2(Math.sin(c)*Math.sin(l)*Math.cos(p),Math.cos(l)-Math.sin(p)*Math.sin(h)),u=(d-g+Math.PI)%(2*Math.PI)-Math.PI,v=new BMapGL.Point(a||u*(180/Math.PI),o||h*(180/Math.PI));return v.lng=parseFloat(v.lng.toFixed(6)),v.lat=parseFloat(v.lat.toFixed(6)),v}var r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAs1JREFUWAnNmb9v01AQx989SzVI8dIBJNZ27Mb/QRpExMiOKAW1Mw3MRVCB2BlRECF/CBtjuwbBwGJL1JXs474vtuU4Tkho4tyTGr9ffvfxvV93VzL/mfYPLndSumqT4buG6Y4MI3+MpyQayc/IEI/Y0DfLW8Ov725cuKYlf2iZ/p3j8FZylT4hQx1m3lvmXSL6zoYH3pZ9PzgNfi367kKA3R634t/REXF6zMa0Fh28rp8IjJjsqb/det3vUVTXp1z3T8DOs/B+kvIHw3y7/OK180Q/PUuPB2+DL/PGsrMaZQrp3tPwJEn488rhIFQ+GGNDBmTN4qht6D7nm3ESfpRBurNeXGk9Ud/3gkf9N/SnOu6UBvE1jcKBSBQBmXWanAJsH0YvGtNcWV0C6WSX6yQ/McVuQ2DNycFW6ddQkdjz6EF54xQg46MkPMfibYimXozsbn872M2PoGKKcc5tHA7IoiDHkuE7DeKGSOP04rqHcL1Klq8VqMj6dgc3jtMgx+mBFjh8DlhwpSI/BiTaR0FTwn0PHnJWiYnPNcHlLNb4uxYmU16h7Qk26+w5bWQZD9hsZmzqRBRDGJsks4JVMgIwN9M1ArIAykRrRHNMwoY1+EMtoLBhDcID05pGMsWsF1DYLPxWrepzPjWcaq2AYLPw+OFUa4MEE9jG1ox4/NoAEYUAkwNEOAJGohZIsICpAITlinCEFkCw5PEbp0GAIVZixGHZOKRzmoQlSwUgvCjESsSG3eDVJ26nMOQeHRgLQBScP0r0EvmNJJFd9onBIOtxMiH80D4MPzUeXZD4zPAseCjHy8QMTmgQqOiAQI5k+pPoayxlwaMqnOOZJXasSRenOVlfKES0JdM6PGu9qoObC5iDqw1g5oBYtIiVGLK9VRzmbgwZC2NWN0Qus/yc2iTlxmoeIRIXhRBHX5bAXrV9XlmmcH1B9DrBTf0b4i99lUEMOuku/wAAAABJRU5ErkJggg==",l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAd9JREFUOBGtVc8rRFEUPufOvELMguTHwkbKjxRlo9gqNpjyFyhTit3I8i1ldpQa5S9QmA1lS9koSn6UZmMxSCyGkPlx3O+9mTe8Zl4zw7eZ7rnn++aee893HlMRzEXFeLh6m2LJTpHwEJG022mcIJZTYbXX2lu/txnilJvO7sDkYnJaC0REqNO993PNTHEiDsfWAru/4vmFaYo6e35dEZIwYh1tPhobNmig20/NjcpKe3rJ0vlNmg5PUnR3n7FiTBwZbGpYNk3OIuCccHIhuQoxv49lNljD4yMG6VMUhT49HRynaGvnU9IZ0Wkcia0HlhxBlCkiOxAz5+u4v8tXVMgdvLjNkLnxbosyB1E+4wEeL5PXuLPQTC1NjBpunud6/yhF0e0PVBNv6Qv0KLwmxHBnKLNSgAMuNKClrNbQKniAUnfm9SfggAtAS9l9RtZrehG99tAJFnTP6n6wmzbfGl7EUnsFrrTbDVYqs4q4FtR20kDTVosClxMK3oQQHFAtHK7WUjA6hGAnOKBSgAMuAC2FqYGmhDdhp0oBDrjQgJayRxBbAwHehJ3KBXLBsfM5DC3H/v81HHIdSYQRpMcX6ekRhjcPjr/KGV+6Unt8xXJlOSfMl/lvAzYviN+/fAK+AW5jAVefzjWGAAAAAElFTkSuQmCC",p="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAABcdJREFUeAHtm0FoHFUYx7+ZbDfJJiZUqcEgBU3BqtGKRdGLHsSTSGxL8agUT230YtGTDQl6EKt4CD1JqPQkastSPImIvVSUQINRK1jrQVNSRRGz3WST3fH/f5k3THY3mmzejLub74Mv8/bNzJv3fnwz773v+yKiogSUgBJQAkpACSgBJaAElIASUAJKQAkoASWgBJSAElACSkAJKIH2J+A1OsQgCIZw7wh0P3Qwpr0oN7MsoHNzMZ1GOe953pVGOr0pgIB2Kx4yCj0AHW7kgU18zyz6dg46CZjXN9rPDQEEOFrVy9DjUGNhhaIEX8+WvEuXy/LbnxX5468AWpHF0kYf/f9c190psrPPl5v7Pdm105cH9nbIQ8PZoKdbLAta6Eno2wDJ8r+KvWndiwDvIE6egg7wooszy/LJhZJ8e6UslQprWl98X+TeoQ556rGsPLpvhx3QPApHAfGsrah3XBcgwPHcCegY1Pv+pxU5nV+Sy1fL9dppm7q9d3TI8yOdcvedGY4pgI5DJwCS5RqpCxDwunHl+9DDlUCCqbOL3vkvmvzdrBna1iqefjwrRw52Bb5nXu0P0dpzgFisbrUGYGh5H+DCw4ViELw5dcOb+aG9ra4aiv29764OefVIDt9Hj5wI8dlqS8TbXyN8bQ28V94pbFt4pELDIQMaEplAyWaNrAEYThhjfG1peb/Mt8kssWbIm/tBBmRBJrhzLGQUNRIBxAkuTzjbevzmbdfXNiITK5AFmZAN9FTIylwRAcQvrvMGONtutwnDkPiPP2RCNmQEJSsjBiCIcofBRbJZqpgzjv88cn8GC1azNHDW8qEns7L7trgNOGu6bkNcxoVyPGQm9ukv4kQvF8lJrfN6cx5mtG6nEG/p9+X10VxqEMmGjMgKOsqCBfgMf3CHkZQsw/p3ZNxCLOPL3n9TuhBjjOgPEB+mSK/KMPe23J4lJdPfLcvfhcApxM++XJZyOV2IZERWZEZ2tEC6pOSrb0peknvbhRsir00WnEL8ea4ib50upgqRjMiKzCAjBEh/nlxKYbdx9deKc4gXZ1ZShxhb4u0nQDpD5Xe4pNKQdoBI910ogxFA+vPSklaHGGMVBxhRTYVjK0Ok4zgUA9CYnvE32OqUjoSIfaZ5ml3i3D7Al6Jx4TfRLni5xJk4lpPObOPt1bszxipgb6/xIrq50xa40eG87Ioem/+8JFt1YAzu8uXAE6vEuE6cOrcoS46XtzFW10iNESoTI4hGkkKB8CaO9cie3R3maR99uiRnzkdbpYZ6QHhvvJTDWHwhvHfPFOXCtNm/NtTeejcxnhLKXASQAZa0pJXhkVGMlQHIuKjQ+5qGtDo8MmIkL5Rpml2ePx6+LxswOpWktAM8MmIYNOSU9+HjZ0R+FoPzGNpLSjJo2vU3r6/XS+WbF2dCRmRFZmRnbY4ReRMXjV/ssvzgPRmnEwb7xshZ0hNGNQPGjkMxzCzASVQuMKjMuGgS0tezOnO5mG1t/xAtS3S2tc+xR7IJA+/MWCCzVX8gTJG5IExnMEFlHl0L41ou4bF/SS5V6o2fAfdQTobMonwQgW+LXtYfoQPvfbzoPC6SgTd/xfGSLIssjJJxENtxJXfk5+KFQ2bRP4+n7AFAWmHkkZaw4ijqAkbkXS9rXMNj59OCRxZkQjZQ5ssYeOyD/QayTIhMpBlnOgMj8lvdl5pGW/wPGZBFmOIxHjKKRhXtSWwNXmXWaWoHIGwktaMGIEECInaqmlzUUHIRAVJCSzyB4hhU09s2k95GgFYAUhMsLYw6x7qvcPV1gMglTk2KL6NTDEYxntIqKb5d2Ehw92JTfPmdox8g3J5x6JxhuSZ2k+LLFq0AJFNAmMXAQPywrW+T4yzGkUySeT1AgDmEesaUGRZlZM8qrbWZhRZGJ7LVLf2bQzMPVPumBJSAElACSkAJKAEloASUgBJQAkpACSgBJaAElIASUAJKQAkoAVcE/gG4Wba8Vno8+QAAAABJRU5ErkJggg==",d=d||{guid:"$BAIDU$"};window[d.guid]={},d.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},d.lang=d.lang||{},d.lang.guid=function(){return"TANGRAM__"+(window[d.guid]._counter++).toString(36)},window[d.guid]._counter=window[d.guid]._counter||1,window[d.guid]._instances=window[d.guid]._instances||{},d.lang.Class=function(t){this.guid=t||d.lang.guid(),window[d.guid]._instances[this.guid]=this},window[d.guid]._instances=window[d.guid]._instances||{},d.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},d.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},d.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},d.lang.Class.prototype.dispose=function(){for(var t in delete window[d.guid]._instances[this.guid],this)d.lang.isFunction(this[t])||delete this[t];this.disposed=!0},d.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},d.lang.Class.prototype.addEventListener=function(t,e,n){if(d.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var i,a=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;e.hashCode=n,i=n}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof a[t]&&(a[t]={}),i=i||d.lang.guid(),e.hashCode=i,a[t][i]=e}},d.lang.Class.prototype.removeEventListener=function(t,e){if(d.lang.isFunction(e))e=e.hashCode;else if(!d.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][e]&&delete n[t][e]},d.lang.Class.prototype.dispatchEvent=function(t,e){for(var n in d.lang.isString(t)&&(t=new d.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{},e)t[n]=e[n];var i=this.__listeners,a=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=a.indexOf("on")&&(a="on"+a),d.lang.isFunction(this[a])&&this[a].apply(this,arguments),"object"==typeof i[a])for(n in i[a])i[a][n].apply(this,arguments);return t.returnValue},d.lang.inherits=function(t,e,n){var i,a,o=t.prototype,s=new Function;for(i in s.prototype=e.prototype,a=t.prototype=new s,o)a[i]=o[i];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof n&&(a._className=n)},d.dom=d.dom||{},d._g=d.dom._g=function(t){return d.lang.isString(t)?document.getElementById(t):t},d.g=d.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},d.insertHTML=d.dom.insertHTML=function(t,e,n){var i,a;return t=d.dom.g(t),t.insertAdjacentHTML?t.insertAdjacentHTML(e,n):(i=t.ownerDocument.createRange(),e=e.toUpperCase(),"AFTERBEGIN"==e||"BEFOREEND"==e?(i.selectNodeContents(t),i.collapse("AFTERBEGIN"==e)):(a="BEFOREBEGIN"==e,i[a?"setStartBefore":"setEndAfter"](t),i.collapse(a)),i.insertNode(i.createContextualFragment(n))),t},d.ac=d.dom.addClass=function(t,e){t=d.dom.g(t);for(var n=e.split(/\s+/),i=t.className,a=" "+i+" ",o=0,s=n.length;o<s;o++)a.indexOf(" "+n[o]+" ")<0&&(i+=(i?" ":"")+n[o]);return t.className=i,t},d.event=d.event||{},d.event._listeners=d.event._listeners||[],d.on=d.event.on=function(t,e,n){e=e.replace(/^on/i,""),t=d._g(t);var i,a=function(e){n.call(t,e)},o=d.event._listeners,s=d.event._eventFilter,r=e;return e=e.toLowerCase(),s&&s[e]&&(i=s[e](t,e,a),r=i.type,a=i.listener),t.addEventListener?t.addEventListener(r,a,!1):t.attachEvent&&t.attachEvent("on"+r,a),o[o.length]=[t,e,n,a,r],t},d.un=d.event.un=function(t,e,n){t=d._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var i,a,o,s=d.event._listeners,r=s.length,l=!n;r--;)i=s[r],i[1]!==e||i[0]!==t||!l&&i[2]!==n||(a=i[4],o=i[3],t.removeEventListener?t.removeEventListener(a,o,!1):t.detachEvent&&t.detachEvent("on"+a,o),s.splice(r,1));return t},d.getEvent=d.event.getEvent=function(t){return window.event||t},d.getTarget=d.event.getTarget=function(t){return t=d.getEvent(t),t.target||t.srcElement},d.preventDefault=d.event.preventDefault=function(t){t=d.getEvent(t),t.preventDefault?t.preventDefault():t.returnValue=!1},d.stopBubble=d.event.stopBubble=function(t){t=d.getEvent(t),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},d.browser=d.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(d.browser.ie=d.ie=document.documentMode||+RegExp.$1);var c=BMapGLLib.DrawingManager=function(t,e){t&&(u.push(this),e=e||{},this.overlays=[],this.labels=[],this.buttons=[],this._initialize(t,e),console.log(t),this._vertex=this._getVertexPosition(t.container),t.addEventListener("touchmove",function(e){t.enableDragging()}),t.addEventListener("touchend",function(e){t.disableDragging()}))};d.lang.inherits(c,d.lang.Class,"DrawingManager"),c.prototype.open=function(){if(1==this._isOpen)return!0;o(this),this._open()},c.prototype.close=function(){if(0==this._isOpen)return!0;var t=this;this._close(),t._map.removeOverlay(h),setTimeout(function(){t._map.enableDoubleClickZoom()},2e3)},c.prototype.setDrawingMode=function(t){this._drawingType!=t&&(o(this),this._setDrawingMode(t))},c.prototype.getDrawingMode=function(){return this._drawingType},c.prototype.enableCalculate=function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()},c.prototype.disableCalculate=function(){this._enableCalculate=!1},c.prototype.enableSorption=function(){this._enableSorption=!0},c.prototype.disableSorption=function(){this._enableSorption=!1},c.prototype.enableGpc=function(){this._enableGpc=!0,this._addGPCLibrary()},c.prototype.disableGpc=function(){this._enableGpc=!1},c.prototype.getOverlays=function(){return this.overlays},c.prototype.addOverlayData=function(t){return this.overlays.push(t)},c.prototype.setOverlaysData=function(t){return this.overlays=t},c.prototype.clearOverlayData=function(t){this._map;for(var e=0;e<this.overlays.length;e++)if(this.overlays[e]===t)return this.overlays.splice(e,1),t;this._removeLabel(t)},c.prototype.clearOverlay=function(t){var e=this._map;t=this.clearOverlayData(t);t&&e.removeOverlay(t)},c.prototype.clearOverlays=function(){var t=this._map,e=this;this.overlays.forEach(function(n){t.removeOverlay(n),e._removeLabel(n)}),this.overlays.length=0},c.prototype._initialize=function(t,e){if(this._map=t,this._opts=e,this._drawingType=e.drawingMode||BMAP_DRAWING_MARKER,e.enableDrawingTool&&this.enableDrawingTool(),void 0!==e.sorptionDistance&&this.setSorptionDistance(e.sorptionDistance),!0===e.enableCalculate?this.enableCalculate():this.disableCalculate(),!0===e.enableLimit){var n=e.limitOptions;this.limit=n}!0===e.enableSorption?this.enableSorption():this.disableSorption(),!0===e.enableGpc?this.enableGpc():this.disableGpc(),this._isOpen=!(!0!==e.isOpen),this._isOpen&&this._open(),this.setPolygonOptions(e.polygonOptions),this.setMarkerOptions(e.markerOptions),this.setCircleOptions(e.circleOptions),this.setPolylineOptions(e.polylineOptions),this.setRectangleOptions(e.rectangleOptions),this.setLabelOptions(e.labelOptions),this.controlButton="right"==e.controlButton?"right":"left",this.skipEditing=void 0!==e.skipEditing&&e.skipEditing},c.prototype.enableDrawingTool=function(){var t=this._opts;if(!this._drawingTool){var e=new a(this,t.drawingToolOptions);this._drawingTool=e}this._map.addControl(this._drawingTool)},c.prototype.disableDrawingTool=function(){this._drawingTool&&this._map.removeControl(this._drawingTool)},c.prototype.setSorptionDistance=function(t){this._sorptionDistance=t||0},c.prototype.setPolygonOptions=function(t){this.polygonOptions=t||{}},c.prototype.setMarkerOptions=function(t){this.markerOptions=t||{}},c.prototype.setCircleOptions=function(t){this.circleOptions=t||{}},c.prototype.setPolylineOptions=function(t){this.polylineOptions=t||{}},c.prototype.setRectangleOptions=function(t){this.rectangleOptions=t||{}},c.prototype.setLabelOptions=function(t){this.labelOptions=t||{}},c.prototype._open=function(){this._isOpen=!0,this._mask||(this._mask=new i),this._map.addOverlay(this._mask),this._setDrawingMode(this._drawingType)},c.prototype._setDrawingMode=function(t){if(this._drawingType=t,this._isOpen)switch(this._mask.__listeners={},t){case BMAP_DRAWING_MARKER:this._bindMarker();break;case BMAP_DRAWING_CIRCLE:this._bindCircle();break;case BMAP_DRAWING_POLYLINE:case BMAP_DRAWING_POLYGON:this._bindPolylineOrPolygon();break;case BMAP_DRAWING_RECTANGLE:this._bindRectangle()}this._drawingTool&&this._isOpen&&this._drawingTool.setStyleByDrawingMode(t)},c.prototype._close=function(){this._isOpen=!1,this._mask&&this._map.removeOverlay(this._mask),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")},c.prototype._skipEditing=function(){var t=this[this._drawingType+"Options"],e=this.skipEditing,n=null;t&&(n=void 0===t.skipEditing?n:t.skipEditing),(n||e)&&!1!==n&&document.getElementById("confirmOperate").click()},c.prototype._bindMarker=function(){var t=this,e=this._map,n=this._mask,i=function(n){console.log(n),n=t._fixTouch(n);var i=new BMapGL.Marker(n.point,t.markerOptions);e.addOverlay(i),t._dispatchOverlayComplete(i)};n.addEventListener(TAP,i)},c.prototype._getVertexPosition=function(t){let e=t,n=0,i=0;for(;null!==e;)n+=e.offsetTop,i+=e.offsetLeft,e=e.offsetParent;return{top:n,left:i}},c.prototype._fixTouch=function(t){if("ontouchend"in document==!1)return t;if(t.changedTouches.length>0){let n=t.changedTouches[0].pageX-this._vertex.left,i=t.changedTouches[0].pageY-this._vertex.top;var e=new BMap.Pixel(n,i);t.point=this._map.pixelToPoint(e)}return t.touch=!0,t},c.prototype._bindPolylineOrPolygon=function(){function t(){for(var t=arguments[0],e=0,n=0,i=0;i<t.length;i++)e<t[i].lng&&(e=t[i].lng,n=i);return t[n]}var n=this,i=this._map,a=this._mask,o=[],s=null,r=null,l=null,p=!1,c=null,u=0,v=function(t){if(MOBILE){var e=t.timeStamp;e-u<200&&setTimeout(()=>{console.log("startAction dblclickAction"),f(t)},200),u=e}if("right"!==n.controlButton||1!==t.button&&0!==t.button){t=n._fixTouch(t);var d=t.point;l&&(d=l),o.push(d),s=o.concat(o[o.length-1]),console.log("startAction click",o),1==o.length?(n._drawingType==BMAP_DRAWING_POLYLINE?r=new BMapGL.Polyline(s,n.polylineOptions):n._drawingType==BMAP_DRAWING_POLYGON&&(r=new BMapGL.Polygon(s,n.polygonOptions)),i.addOverlay(r),MOBILE&&(h=new BMapGL.Label("开始测量，双击结束",{position:d,offset:new BMapGL.Size(-60,-50)}),h.setStyle(n.labelOptions),i.addOverlay(h),g=new BMapGL.Marker(t.point,n.markerOptions),i.addOverlay(g))):r.setPath(s),MOBILE&&i.disableDragging(),p||(p=!0,a.enableEdgeMove(),MOBILE?a.addEventListener(TOUCH_END,_):(a.removeEventListener(TOUCH_MOVE,m),a.addEventListener(TOUCH_MOVE,y),a.addEventListener("dblclick",f)))}},y=function(t){t=n._fixTouch(t);var e=t.point;if(n._enableSorption){var a=n.getSorptionMatch(e,n.overlays,n._sorptionDistance);if(a&&a.length>0)return l=a[0].point,void r.setPositionAt(s.length-1,a[0].point)}l=null,r.setPositionAt(s.length-1,t.point),i.removeOverlay(h),h=new BMapGL.Label("单击绘制下一个点，双击完成绘制",{position:t.point,offset:new BMapGL.Size(10,10)}),h.setStyle(n.labelOptions),i.addOverlay(h)},f=function(l){d.stopBubble(l),p=!1,i.removeOverlay(h),a.disableEdgeMove(),a.removeEventListener(TOUCH_START,v),MOBILE?(a.removeEventListener(TOUCH_END,_),i.removeOverlay(h),i.removeOverlay(g)):(a.removeEventListener(TOUCH_MOVE,m),a.removeEventListener(TOUCH_MOVE,y),a.removeEventListener("dblclick",f)),"right"==n.controlButton?o.push(l.point):d.ie<=8||o.pop();try{if(n._enableGpc&&window.gpcas&&"polygon"===n._drawingType){for(var c=new gpcas.geometry.PolyDefault,u=0;u<o.length;u++)c.addPoint(new gpcas.Point(o[u].lng,o[u].lat));for(var M=0;M<n.overlays.length;M++){var w=n.overlays[M].getPath(),b=new gpcas.geometry.PolyDefault;for(u=0;u<w.length;u++)b.addPoint(new gpcas.Point(w[u].lng,w[u].lat));var E=c.difference(b),L=E.getPoints(),O=[];for(u=0;u<L.length;u++)O.push(new BMapGL.Point(L[u].x,L[u].y));c=new gpcas.geometry.PolyDefault;for(u=0;u<L.length;u++)c.addPoint(new gpcas.Point(L[u].x,L[u].y));o=O}}}catch(l){}r.setPath(o);var A=i.getViewport(o);A.zoom-=1,i.setViewport(A),r.enableEditing();var B=null;n.limit&&(B="polygon"===n._drawingType?n.limit.area:n.limit.distance);var T={limit:B,type:n._drawingType,point:t(o),overlay:r,overlays:[]},P=new e(T,n);i.addOverlay(P),n._skipEditing(),r.addEventListener("click",function(t){console.log("TOUCH_START",t)}),r.addEventListener("lineupdate",function(e){console.log("lineupdate",e);var n=t(e.currentTarget.getPath());P.setPosition(n,!0),P.updateWindow()}),o.length=0,s.length=0,i.removeOverlay(a)},m=function(t){t=n._fixTouch(t),d.preventDefault(t),d.stopBubble(t),i.removeOverlay(h),h=new BMapGL.Label("单击确认起点",{position:t.point,offset:new BMapGL.Size(10,10)}),h.setStyle(n.labelOptions),i.addOverlay(h)},_=function(t){clearTimeout(c),c=null};a.addEventListener(TOUCH_START,v),a.addEventListener(TOUCH_MOVE,m),a.addEventListener("dblclick",function(t){d.stopBubble(t)}),console.log(i)};var h=null,g=null;c.prototype._bindCircle=function(){var t=this,i=this._map,a=this._mask,o=null,l=[],c=null,g=1,u=null,v=null,y=null,f=null,m={strokeColor:"#4E6DF1",strokeWeight:2},_=new BMapGL.Icon(r,new BMapGL.Size(20,20)),M=new BMapGL.Icon(p,new BMapGL.Size(40,20),{imageOffset:new BMapGL.Size(0,10)}),w=function(e){if(e=t._fixTouch(e),"right"!=t.controlButton||1!=e.button&&0!=e.button){c=e.point;var n=new BMapGL.Marker(c);_.setImageSize(new BMapGL.Size(20,20)),n.setIcon(_),n.enableDragging(),n.addEventListener("dragstart",A),n.addEventListener("dragging",B),n.addEventListener("dragend",T),i.addOverlay(n),MOBILE&&i.disableDragging(),l.push(n),o=new BMapGL.Circle(c,g,t.circleOptions),i.addOverlay(o),a.enableEdgeMove(),a.addEventListener(TOUCH_MOVE,b),d.on(document,TOUCH_END,E)}},b=function(e){e=t._fixTouch(e),g=t._map.getDistance(c,e.point).toFixed(0),o.setRadius(g),i.removeOverlay(h),h=new BMapGL.Label("半径："+g+"米<br>松开完成绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),h.setStyle(t.labelOptions),i.addOverlay(h)},E=function(r){r=t._fixTouch(r);var p=i.getViewport(o.getBounds());p.zoom-=1,i.setViewport(p),i.removeOverlay(h);var _=new BMapGL.Point(o.getBounds().getNorthEast().lng,c.lat);a.hide(),u=new BMapGL.Marker(_),u.setIcon(M),u.enableDragging(),v=new BMapGL.Polyline([c,_],m);var w=new BMapGL.Point((o.getBounds().getNorthEast().lng+c.lng)/2,c.lat);y=new n("circle",w,g,o,t),l=l.concat([u,v,y]);var O=null;t.limit&&(O=t.limit.area);var A={limit:O,type:"circle",point:_,overlay:o,overlays:l};f=new e(A,t),i.addOverlay(u),i.addOverlay(v),i.addOverlay(y),i.addOverlay(f),t._skipEditing(),y.addEventListener("radiuschange",function(t){var e=t.radius;o.setRadius(e);var n=s(c,e,"east"),i=new BMapGL.Point(n.lng,c.lat),a=n.lng>c.lng?(o.getBounds().getNorthEast().lng+c.lng)/2:(o.getBounds().getSouthWest().lng+c.lng)/2,r=new BMapGL.Point(a,c.lat);u.setPosition(i),y.setInfo(r,e),f.setPosition(i,!0),f.setZIndexTop(),f.updateWindow(),v.setPath([c,i])}),u.addEventListener("dragging",function(e){var n=new BMapGL.Point(e.latLng.lng,c.lat),i=e.latLng.lng>c.lng?(o.getBounds().getNorthEast().lng+c.lng)/2:(o.getBounds().getSouthWest().lng+c.lng)/2,a=e.latLng.lng>c.lng,s=new BMapGL.Point(i,c.lat);e.target.setPosition(n),y.setInfo(s,t._map.getDistance(c,e.latLng).toFixed(0)),f.setPosition(n,a),v.setPath([c,n]),g=t._map.getDistance(c,e.latLng).toFixed(0),o.setRadius(t._map.getDistance(c,e.latLng))}),u.addEventListener("dragend",function(t){f.updateWindow()}),a.disableEdgeMove(),a.removeEventListener(TOUCH_MOVE,b),a.removeEventListener(TOUCH_MOVE,L),d.un(document,TOUCH_END,E),i.removeOverlay(a)},L=function(e){e=t._fixTouch(e),d.preventDefault(e),d.stopBubble(e),"right"==t.controlButton&&1==e.button||null==c&&w(e)},O=function(e){e=t._fixTouch(e),d.preventDefault(e),d.stopBubble(e),i.removeOverlay(h),h=new BMapGL.Label("按下确认中心点，拖拽确认半径",{position:e.point,offset:new BMapGL.Size(10,10)}),h.setStyle(t.labelOptions),i.addOverlay(h)},A=function(t){i.removeOverlay(u),i.removeOverlay(v),i.removeOverlay(y),i.removeOverlay(f)},B=function(t){c=t.latLng,o.setCenter(t.latLng)},T=function(t){c=t.latLng,E(t)};a.addEventListener(TOUCH_START,L),a.addEventListener(TOUCH_MOVE,O)},c.prototype._bindRectangle=function(){function t(t,e){var n=new BMapGL.Point(t.lng,t.lat),i=new BMapGL.Point(e.lng,t.lat),a=new BMapGL.Point(e.lng,e.lat),o=new BMapGL.Point(t.lng,e.lat),s=new BMapGL.Point((t.lng+e.lng)/2,t.lat),r=new BMapGL.Point(e.lng,(t.lat+e.lat)/2),l=new BMapGL.Point((t.lng+e.lng)/2,e.lat),p=new BMapGL.Point(t.lng,(t.lat+e.lat)/2);return[n,s,i,r,a,l,o,p]}var i=this,a=this._map,o=this._mask,r=null,p=null,c=new BMapGL.Icon(l,new BMapGL.Size(10,10));c.setImageSize(new BMapGL.Size(10,10));var g=function(t){if(t=i._fixTouch(t),d.stopBubble(t),d.preventDefault(t),"right"!=i.controlButton||1!=t.button&&0!=t.button){p=t.point;var e=p;r=new BMapGL.Polygon(i._getRectanglePoint(p,e),i.rectangleOptions),a.addOverlay(r),a.disableDragging(),o.enableEdgeMove(),o.addEventListener(TOUCH_MOVE,u),d.on(document,TOUCH_END,v)}},u=function(e){e=i._fixTouch(e),a.removeOverlay(h),r.setPath(i._getRectanglePoint(p,e.point));var n=t(p,e.point),o=i._map.getDistance(p,n[2]).toFixed(0),s=i._map.getDistance(p,n[6]).toFixed(0);h=new BMapGL.Label("尺寸："+o+"米 x "+s+"米<br>松开结束绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),h.setStyle(i.labelOptions),a.addOverlay(h)},v=function(l){l=i._fixTouch(l),o.hide();var g=null,f=[],m=[],_=t(p,l.point),M=[],w=a.getViewport(_);w.zoom-=1,a.setViewport(w),a.removeOverlay(h);for(var b=i._map.getDistance(p,_[2]).toFixed(0),E=i._map.getDistance(p,_[6]).toFixed(0),L=new n("rectangle",_[0],{width:b,height:E},r,i),O=0;O<_.length;O++){var A=new BMapGL.Marker(_[O]);A.setIcon(c),A.enableDragging(),f.push(A),a.addOverlay(A),M[O]=i.mc2ll(A.point),m[O]={hashCode:A.hashCode,point:i.mc2ll(A.point)},MOBILE?A.addEventListener("dragstart",function(t){a.disableDragging();var e=m.find(e=>e.hashCode==t.target.hashCode);e&&(g=e.point)}):A.addEventListener("mousedown",function(t){console.log("mousedown",t),g=i.mc2ll(t.target.point)}),A.addEventListener("dragging",function(e){for(var n=e.latLng,a=0;a<M.length;a++)g.lng==M[a].lng&&(_[a].lng=n.lng),g.lat==M[a].lat&&(_[a].lat=n.lat);_=t(_[0],_[4]);for(a=0;a<f.length;a++)f[a].setPosition(_[a]);b=i._map.getDistance(_[0],_[2]).toFixed(0),E=i._map.getDistance(_[0],_[6]).toFixed(0),L.setInfo(_[0],{width:b,height:E}),x.setPosition(_[3],!0),r.setPath(_)}),A.addEventListener("dragend",function(t){for(var e=0;e<f.length;e++){var n=f[e];M[e]=i.mc2ll(n.point),m[e]={hashCode:n.hashCode,point:i.mc2ll(n.point)}}x.updateWindow()})}L.addEventListener("rectwhchange",function(e){var n=e.width,a=e.height,o=s(_[0],n,"east"),l=s(_[0],a,"south");_[4].lng=o.lng,_[4].lat=l.lat,_=t(_[0],_[4]);for(var p=0;p<f.length;p++)f[p].setPosition(_[p]);L.setInfo(_[0],{width:n,height:a}),x.setPosition(_[3],!0),r.setPath(_);for(var d=0;d<f.length;d++){var c=f[d];M[d]=i.mc2ll(c.point)}x.updateWindow()});var B=[f,L],T=null;i.limit&&(T=i.limit.area);var P={limit:T,type:"rectangle",point:_[3],overlay:r,overlays:B},x=new e(P,i);a.addOverlay(x),a.addOverlay(L),o.disableEdgeMove(),o.removeEventListener(TOUCH_MOVE,u),o.removeEventListener(TOUCH_MOVE,y),i._skipEditing(),d.un(document,TOUCH_END,v),a.removeOverlay(o)},y=function(t){t=i._fixTouch(t),d.preventDefault(t),d.stopBubble(t),a.removeOverlay(h),h=new BMapGL.Label("按住确认起点，拖拽进行绘制",{position:t.point,offset:new BMapGL.Size(10,10)}),h.setStyle(i.labelOptions),a.addOverlay(h)};o.addEventListener(TOUCH_START,g),o.addEventListener(TOUCH_MOVE,y)},c.prototype._calculate=function(t){var e={data:0,label:null};if(this._enableCalculate&&BMapGLLib.GeoUtils){var n=t.toString();switch(n){case"Polyline":e.data=BMapGLLib.GeoUtils.getPolylineDistance(t);break;case"Polygon":e.data=this._getPolygonArea(t);break;case"Circle":var i=t.getRadius();e.data=Math.PI*i*i}!e.data||e.data<0?e.data=0:e.data=e.data.toFixed(2);var a=this._opts;a.enablePrintResult&&(e.label=this._addLabel(t,e.data+("Polyline"==n?" 米":" 平方米")))}return e},c.prototype._getPolygonArea=function(t){if(!(t instanceof BMapGL.Polygon||t instanceof Array))return 0;var e;if(e=t instanceof BMapGL.Polygon?t.getPath():t,e.length<3)return 0;let n=e.map(function(t){return[t.lng,t.lat]});return turf.area(turf.polygon([n]))},c.prototype._addGeoUtilsLibrary=function(){if(!BMapGLLib.GeoUtils){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","https://cdn.bootcdn.net/ajax/libs/Turf.js/6.5.0/turf.min.js"),document.body.appendChild(t);var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","//mapopen.cdn.bcebos.com/github/BMapGLLib/GeoUtils/src/GeoUtils.min.js"),document.body.appendChild(e)}},c.prototype._addGPCLibrary=function(){if(!window.gpcas){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","//mapopen.cdn.bcebos.com/github/BMapGLLib/DrawingManager/src/gpc.js"),document.body.appendChild(t)}},c.prototype._addLabel=function(t,e){let n=t.getPath();if(Array.isArray(n)||(n=[n]),!e)return;let i=t.hashCode,a=n.map(t=>t.lng),o=n.map(t=>t.lat),s=Math.max(...a),r=Math.min(...a),l=r+(s-r)/2,p=Math.max(...o),d=Math.min(...o),c=d+(p-d)/2,h={lng:l,lat:c};var g=new BMapGL.Label(e,{position:h,offset:new BMapGL.Size(4*-e.length,-10)});return this._removeLabel(t),this._map.addOverlay(g),this.labels.push({hashCode:i,label:g}),g},c.prototype._removeLabel=function(t){let e=t.hashCode,n=this.labels.findIndex(t=>t.hashCode==e);-1!=n&&(old=this.labels[n],this.labels.splice(n,1),this._map.removeOverlay(old.label))},c.prototype._addButtons=function(e){let n=e.overlay,i=n.hashCode;this._removeButtons(n),this._removeButtons(n);let a=new t(e);return this._map.addOverlay(a),this.buttons.push({hashCode:i,overlay:n}),a},c.prototype._removeButtons=function(t){let e=t.hashCode,n=this.buttons.findIndex(t=>t.hashCode==e);-1!=n&&(old=this.buttons[n],this.buttons.splice(n,1),this._map.removeOverlay(old.overlay))},t.prototype=new BMapGL.Overlay,t.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,t.prototype.addEventListener=d.lang.Class.prototype.addEventListener,t.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener,t.prototype.initialize=function(){var t=this;this.hashCode=t.overlay.hashCode;var e=this.div=document.createElement("div");e.className="operateWindow";var n='<div><span class="finalOperate cancelOperate_'+this.hashCode+'"></span></div>';return e.innerHTML=n,this._map.getPanes().markerPane.appendChild(e),this.updateWindow(),this._bind(e),this._bind(e),this.setPosition(this.point),e},t.prototype._bind=function(t){var e=this,n=this._map,i=this.overlay;t.addEventListener("click",function(t){n.removeOverlay(e),n.removeOverlay(i),e.DrawingManager._removeLabel(i)})},t.prototype.setPosition=function(t,e){this.point=t;var n=this._map,i=n.pointToOverlayPixel(this.point);e?(this.div.classList.remove("operateLeft"),this.div.style.left=i.x+15+"px"):(this.div.classList.add("operateLeft"),this.div.style.left=i.x-105+"px"),this.div.style.top=i.y-16+"px"},t.prototype.updateWindow=function(){let t=document.getElementsByClassName("cancelOperate_"+this.hashCode);t.length>0&&(t[0].style.display="block")},t.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this.point);this.div.style.left=e.x+15+"px",this.div.style.top=e.y-16+"px"},c.prototype._getRectanglePoint=function(t,e){return[new BMapGL.Point(t.lng,t.lat),new BMapGL.Point(e.lng,t.lat),new BMapGL.Point(e.lng,e.lat),new BMapGL.Point(t.lng,e.lat)]},c.prototype._dispatchOverlayComplete=function(t,e){var n={overlay:t,drawingMode:this._drawingType};e&&(n.calculate=e.data||null,n.label=e.label||null),this.dispatchEvent(this._drawingType+"complete",t),this.dispatchEvent("overlaycomplete",n)},c.prototype._dispatchOverlayCancel=function(t){var e={overlay:t,drawingMode:this._drawingType};this.dispatchEvent(this._drawingType+"cancel",t),this.dispatchEvent("overlaycancel",e)},c.prototype.getSorptionMatch=function(t,e,n){n=n||20;for(var i=this._map,a=i.pointToPixel(t),o=[],s=0;s<e.length;s++){var r=e[s].getPath(),l=r[0],p=r[r.length-1];l.equals(p)||r.push(r[0]);for(var d=1;d<r.length;d++){var c=i.pointToPixel(r[d-1]),h=i.pointToPixel(r[d]),g=[a.x-c.x,a.y-c.y],u=[h.x-c.x,h.y-c.y],v=[h.x-a.x,h.y-a.y],y=g[0]*u[0]+g[1]*u[1],f=Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2))*Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2)),m=Math.acos(y/f),_=u[0]*v[0]+u[1]*v[1],M=Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2))*Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2)),w=Math.acos(_/M);if(m<Math.PI/2&&w<Math.PI/2){var b=Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2)),E=Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2)),L=Math.cos(m)*b,O=L/E,A=Math.sin(m)*b,B=[c.x+u[0]*O,c.y+u[1]*O];A<n&&o.push({point:i.pixelToPoint({x:B[0],y:B[1]}),length:A})}}}o.sort(function(t,e){return t.length-e.length});var T=o.length>0?o:null;return T},c.prototype.mc2ll=function(t){var e=this._map,n=e.mercatorToLnglat(t.lng,t.lat);return new BMapGL.Point(n[0],n[1])},c.prototype.ll2mc=function(t){var e=this._map,n=e.lnglatToMercator(t.lng,t.lat);return new BMapGL.Point(n[0],n[1])},e.prototype=new BMapGL.Overlay,e.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,e.prototype.addEventListener=d.lang.Class.prototype.addEventListener,e.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener,e.prototype.initialize=function(t){this._map=t;var e="polyline"===this.type?"长度":"面积",n="polyline"===this.type?"万米":"万平方米",i=this.div=document.createElement("div");i.className="operateWindow";var a='<div><span id="confirmOperate"></span><span id="cancelOperate"></span><span id="warnOperate">'+e+"不超过"+this.limit/1e4+n+"！</span></div>";return i.innerHTML=a,this._map.getPanes().markerPane.appendChild(i),this.updateWindow(),this._bind(),i},e.prototype._bind=function(){var t=this,e=this._map,n=this.overlay,i=this.overlays;document.getElementById("confirmOperate").addEventListener("click",function(a){if(e.removeOverlay(t),e.enableDragging(),"rectangle"==t.type){var o=t.DrawingManager._calculate(n);t.DrawingManager.overlays.push(n)}else if("circle"==t.type){o=t.DrawingManager._calculate(n)
;t.DrawingManager.overlays.push(n)}else if("polygon"==t.type){o=t.DrawingManager._calculate(n);t.DrawingManager.overlays.push(n),n.disableEditing()}else if("polyline"==t.type){o=t.DrawingManager._calculate(n);t.DrawingManager.overlays.push(n),n.disableEditing()}var s=t.DrawingManager._opts;s.enableRemove&&t.DrawingManager._addButtons({type:t.type,point:t.point,overlay:n,DrawingManager:t.DrawingManager,map:e}),t.DrawingManager._dispatchOverlayComplete(n,o);for(var r=0;r<i.length;r++)if(Array.isArray(i[r]))for(var l in i[r])e.removeOverlay(i[r][l]);else e.removeOverlay(i[r]);t.DrawingManager.close()}),document.getElementById("cancelOperate").addEventListener("click",function(a){e.removeOverlay(t),e.enableDragging();for(var o=0;o<i.length;o++)if(Array.isArray(i[o]))for(var s in i[o])e.removeOverlay(i[o][s]);else e.removeOverlay(i[o]);e.removeOverlay(n),t.DrawingManager._removeLabel(n),t.DrawingManager._dispatchOverlayCancel(n),t.DrawingManager.close()})},e.prototype.updateWindow=function(){if(null!==this.domElement){var t,e=this.overlay,n=this.limit;"rectangle"==this.type?t=this.DrawingManager._calculate(e):"circle"==this.type?t=this.DrawingManager._calculate(e):"polygon"==this.type?t=this.DrawingManager._calculate(e):"polyline"==this.type&&(t=this.DrawingManager._calculate(e)),"[object Number]"===Object.prototype.toString.call(n)&&t.data>n?(document.getElementById("confirmOperate").style.display="none",document.getElementById("warnOperate").style.display="block"):(document.getElementById("confirmOperate").style.display="block",document.getElementById("warnOperate").style.display="none")}},e.prototype.setPosition=function(t,e){this.point=t;var n=this._map,i=n.pointToOverlayPixel(this.point);e?(this.div.classList.remove("operateLeft"),this.div.style.left=i.x+15+"px"):(this.div.classList.add("operateLeft"),this.div.style.left=i.x-105+"px"),this.div.style.top=i.y-16+"px"},e.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this.point);this.div.style.left=e.x+15+"px",this.div.style.top=e.y-16+"px"},n.prototype=new BMapGL.Overlay,n.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,n.prototype.addEventListener=d.lang.Class.prototype.addEventListener,n.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener,n.prototype.initialize=function(t){this._map=t;var e=this.div=document.createElement("div");if(e.className="screenshot","circle"==this.type)var n='<div class="circlShot"><span id="screenshotNum">'+this.number+'</span><input id="circleInput" type="text" /><span class="unit">米</span></div>';else if("rectangle"==this.type)n='<div class="rectWH"><div class="wh"><span id="rectWidth">'+this.number.width+'</span><input id="rectWidthInput" type="text" /></div><span class="multiple">x</span><div class="wh"><span id="rectHeight">'+this.number.height+'</span><input id="rectHeightInput" type="text" /></div><span class="unit">米</span></div>';return e.innerHTML=n,this._map.getPanes().markerPane.appendChild(e),this._bind(),e},n.prototype._bind=function(){this.setNumber(this.number),"circle"==this.type?this.bindCircleEvent():this.bindRectEvent()},n.prototype.bindCircleEvent=function(){var t=this,e=document.getElementById("screenshotNum"),n=document.getElementById("circleInput");e.addEventListener("click",function(t){var i=e.innerText;e.style.display="none",n.value=i,n.style.display="inline-block",n.focus()}),n.addEventListener("click",function(t){n.focus()}),n.addEventListener("keydown",function(i){if(13===i.keyCode){var a=n.value;n.style.display="none",e.style.display="inline-block",e.innerText=a;var o={radius:a,overlay:t.overlay};t._dispatchRadiusChange(o)}}),n.addEventListener("blur",function(i){var a=n.value;n.style.display="none",e.style.display="inline-block",e.innerText=a;var o={radius:a,overlay:t.overlay};t._dispatchRadiusChange(o)})},n.prototype.bindRectEvent=function(){var t=this,e=document.getElementById("rectWidth"),n=document.getElementById("rectWidthInput"),i=document.getElementById("rectHeight"),a=document.getElementById("rectHeightInput");n.value=e.innerText,a.value=i.innerText,e.addEventListener("click",function(t){var i=e.innerText;e.style.display="none",n.value=i,n.style.display="inline-block",n.focus()}),i.addEventListener("click",function(t){var e=i.innerText;i.style.display="none",a.value=e,a.style.display="inline-block",a.focus()}),n.addEventListener("click",function(t){n.focus()}),a.addEventListener("click",function(t){a.focus()}),n.addEventListener("keydown",function(o){if(13===o.keyCode){var s=n.value,r=a.value;n.style.display="none",a.style.display="none",e.style.display="inline-block",i.style.display="inline-block",e.innerText=s,i.innerText=r;var l={width:s,height:r,overlay:t.overlay};t._dispatchRectWHChange(l)}}),a.addEventListener("keydown",function(o){if(13===o.keyCode){var s=n.value,r=a.value;n.style.display="none",a.style.display="none",e.style.display="inline-block",i.style.display="inline-block",e.innerText=s,i.innerText=r;var l={width:s,height:r,overlay:t.overlay};t._dispatchRectWHChange(l)}})},n.prototype.setInfo=function(t,e){this.setNumber(e),this.setPosition(t)},n.prototype.setNumber=function(t){"circle"==this.type?document.getElementById("screenshotNum").textContent=t:(document.getElementById("rectWidth").textContent=t.width,document.getElementById("rectHeight").textContent=t.height)},n.prototype.setPosition=function(t){this.point=t;var e=this._map,n=this.type,i=e.pointToOverlayPixel(this.point);"circle"==n?(this.div.style.left=i.x-30+"px",this.div.style.top=i.y-40+"px"):"rectangle"==n&&(this.div.style.left=i.x+"px",this.div.style.top=i.y-45+"px")},n.prototype.draw=function(){var t=this._map,e=this.type,n=t.pointToOverlayPixel(this.point);"circle"==e?(this.div.style.left=n.x-30+"px",this.div.style.top=n.y-40+"px"):"rectangle"==e&&(this.div.style.left=n.x+"px",this.div.style.top=n.y-45+"px")},n.prototype._dispatchRadiusChange=function(t){this.dispatchEvent("radiuschange",t)},n.prototype._dispatchRectWHChange=function(t){this.dispatchEvent("rectwhchange",t)},i.prototype=new BMapGL.Overlay,i.prototype.dispatchEvent=d.lang.Class.prototype.dispatchEvent,i.prototype.addEventListener=d.lang.Class.prototype.addEventListener,i.prototype.removeEventListener=d.lang.Class.prototype.removeEventListener,i.prototype.initialize=function(t){var e=this;this._map=t;var n=this.container=document.createElement("div"),i=this._map.getSize();return n.style.cssText="position:absolute;background:transparent;cursor:crosshair;width:"+i.width+"px;height:"+i.height+"px",this._map.addEventListener("resize",function(t){e._adjustSize(t.size)}),this._map.getPanes().floatPane.appendChild(n),this._bind(),n},i.prototype.draw=function(){var t=this._map,e=t.pixelToPoint(new BMapGL.Pixel(0,0)),n=t.pointToOverlayPixel(e);this.container.style.left=n.x+"px",this.container.style.top=n.y+"px"},i.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},i.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},i.prototype._bind=function(){for(var t=this,e=(this._map,this.container),n=null,i=null,a=function(t){return{x:t.clientX,y:t.clientY}},o=function(e){var o=e.type;e=d.getEvent(e),point=t.getDrawPoint(e);var s=function(n){e.point=point,t.dispatchEvent(e)};o==TOUCH_START&&(n=a(e));var r=a(e);"click"==o?Math.abs(r.x-n.x)<5&&Math.abs(r.y-n.y)<5&&(i&&Math.abs(r.x-i.x)<5&&Math.abs(r.y-i.y)<5?i=null:(s("click"),i=a(e))):s(o)},s=["click","mousedown","mousemove","mouseup","dblclick","tap","doubleTap","touchstart","touchmove","touchend","touchcancel"],r=s.length;r--;)d.on(e,s[r],o);d.on(e,TOUCH_MOVE,function(e){t._enableEdgeMove&&t.mousemoveAction(e)})},i.prototype.mousemoveAction=function(t){function e(t){var e=t.clientX,n=t.clientY;return t.changedTouches&&(e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY),new BMapGL.Pixel(e,n)}var n=this._map,i=this,a=n.pointToPixel(this.getDrawPoint(t)),o=e(t),s=o.x-a.x,r=o.y-a.y;a=new BMapGL.Pixel(o.x-s,o.y-r),this._draggingMovePixel=a;n.pixelToPoint(a);this._panByX=this._panByY=0,a.x<=20||a.x>=n.width-20||a.y<=50||a.y>=n.height-10?(a.x<=20?this._panByX=8:a.x>=n.width-20&&(this._panByX=-8),a.y<=50?this._panByY=8:a.y>=n.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval(function(){n.panBy(i._panByX,i._panByY,{noAnimation:!0})},30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},i.prototype._adjustSize=function(t){this.container.style.width=t.width+"px",this.container.style.height=t.height+"px"},i.prototype.getDrawPoint=function(t){var e=this._map,n=d.getTarget(t),i=t.offsetX||t.layerX||0,a=t.offsetY||t.layerY||0;for(1!=n.nodeType&&(n=n.parentNode);n&&n!=e.getContainer();)0==n.clientWidth&&0==n.clientHeight&&n.offsetParent&&"TD"==n.offsetParent.nodeName||(i+=n.offsetLeft||0,a+=n.offsetTop||0),n=n.offsetParent;var o=new BMapGL.Pixel(i,a),s=e.pixelToPoint(o);return s},a.prototype=new BMapGL.Control,a.prototype.initialize=function(t){var e=this.container=document.createElement("div");e.className="BMapGLLib_Drawing";var n=this.panel=document.createElement("div");n.className="BMapGLLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.hasCustomStyle&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),e.appendChild(n);var i=this._generalHtml();n.appendChild(i);var a=this.tip=document.createElement("div");return a.className="BMapGLLib_tip",a.innerHTML='<p class="BMapGLLib_tip_title"></p><p class="BMapGLLib_tip_text"></p>',!0===this.drawingToolOptions.enableTips&&n.appendChild(a),this._bind(n),this.drawingToolOptions.customContainer?d.g(this.drawingToolOptions.customContainer).appendChild(e):t.getContainer().appendChild(e),e},a.prototype._generalHtml=function(t){var e=this,n={hander:"拖动地图"};n[BMAP_DRAWING_MARKER]="画点",n[BMAP_DRAWING_CIRCLE]="圆形工具",n[BMAP_DRAWING_POLYLINE]="画折线",n[BMAP_DRAWING_POLYGON]="多边形工具",n[BMAP_DRAWING_RECTANGLE]="矩形工具";for(var i=function(t,i){var a=document.createElement("a");return a.className=t,a.href="javascript:void(0)",a.setAttribute("drawingType",i),a.setAttribute("onfocus","this.blur()"),a.addEventListener("mouseenter",function(t){var i=t.target.getAttribute("drawingType"),a=n[i];"hander"===i?(e.tip.children[0].innerText=a,e.tip.children[1].innerText="使用鼠标拖动地图"):(e.tip.className+=" "+i,e.tip.children[0].innerText=a,e.tip.children[1].innerText="使用"+a+"选出目标区域"),e.tip.style.display="block"}),a.addEventListener("mouseleave",function(t){for(var n=t.target.getAttribute("drawingType"),i=" "+e.tip.className.replace(/[\t\r\n]/g,"")+" ";i.indexOf(" "+n+" ")>=0;)i=i.replace(" "+n+" "," ");e.tip.className=i.replace(/^\s+|\s+$/g,""),e.tip.style.display="none"}),a},a=document.createDocumentFragment(),o=0,s=this.drawingModes.length;o<s;o++){var r="BMapGLLib_box BMapGLLib_"+this.drawingModes[o];o==s-1&&(r+=" BMapGLLib_last"),a.appendChild(i(r,this.drawingModes[o]))}return a},a.prototype._setScale=function(t){var e=390,n=50,i=-parseInt((e-e*t)/2,10),a=-parseInt((n-n*t)/2,10);this.container.style.cssText=["-moz-transform: scale("+t+");","-o-transform: scale("+t+");","-webkit-transform: scale("+t+");","transform: scale("+t+");","margin-left:"+i+"px;","margin-top:"+a+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+t+",","M12=0,","M21=0,","M22="+t+",","SizingMethod='auto expand');"].join("")},a.prototype._bind=function(t){var e=this;d.on(this.panel,"click",function(t){var n=d.getTarget(t),i=n.getAttribute("drawingType");e.setStyleByDrawingMode(i),e._bindEventByDraingMode(i)})},a.prototype.setStyleByDrawingMode=function(t){if(t)for(var e=this.panel.getElementsByTagName("a"),n=0,i=e.length;n<i;n++){var a=e[n];if(a.getAttribute("drawingType")==t){var o="BMapGLLib_box BMapGLLib_"+t+"_hover";n==i-1&&(o+=" BMapGLLib_last"),a.className=o}else a.className=a.className.replace(/_hover/,"")}},a.prototype._bindEventByDraingMode=function(t){var e=this.drawingManager;e._isOpen&&e.getDrawingMode()===t?(e.close(),e._map.enableDoubleClickZoom()):(e.setDrawingMode(t),e.open(),e._map.disableDoubleClickZoom())};var u=[]}();