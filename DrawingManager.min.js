var BMapGLLib=window.BMapGLLib=BMapGLLib||{},BMAP_DRAWING_MARKER="marker",BMAP_DRAWING_POLYLINE="polyline",BMAP_DRAWING_CIRCLE="circle",BMAP_DRAWING_RECTANGLE="rectangle",BMAP_DRAWING_POLYGON="polygon";(function(){function t(t,e){this.limit=t.limit,this.type=t.type,this.point=t.point,this.overlay=t.overlay,this.overlays=t.overlays,this.DrawingManager=e}function e(t,e,n,i,a){this.type=t,this.point=e,this.number=n,this.overlay=i,this.DrawingManager=a}function n(){this._enableEdgeMove=!1}function i(t,e){this.drawingManager=t,e=this.drawingToolOptions=e||{},this._opts={},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMapGL.Size(10,10),this.defaultDrawingModes=[BMAP_DRAWING_MARKER,BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYLINE,BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE],e.drawingModes?this.drawingModes=e.drawingModes:this.drawingModes=this.defaultDrawingModes,e.hasCustomStyle&&(e.anchor&&this.setAnchor(e.anchor),e.offset&&this.setOffset(e.offset))}function a(t){for(var e=h.length;e--;)h[e]!=t&&h[e].close()}function o(t,e,n){var i,a,o,s=t.lng,r=t.lat,l=e/6378800,p=Math.PI/180*r,d=Math.PI/180*s;switch(n){case"North":case"north":case"N":case"n":i=0,a=t.lng;break;case"West":case"west":case"W":case"w":i=90,o=t.lat;break;case"South":case"south":case"S":case"s":i=180,a=t.lng;break;case"East":case"east":case"E":case"e":i=270,o=t.lat;break;default:i=~~n}var c=Math.PI/180*i,h=Math.asin(Math.sin(p)*Math.cos(l)+Math.cos(p)*Math.sin(l)*Math.cos(c)),g=Math.atan2(Math.sin(c)*Math.sin(l)*Math.cos(p),Math.cos(l)-Math.sin(p)*Math.sin(h)),u=(d-g+Math.PI)%(2*Math.PI)-Math.PI,v=new BMapGL.Point(a||u*(180/Math.PI),o||h*(180/Math.PI));return v.lng=parseFloat(v.lng.toFixed(6)),v.lat=parseFloat(v.lat.toFixed(6)),v}var s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAs1JREFUWAnNmb9v01AQx989SzVI8dIBJNZ27Mb/QRpExMiOKAW1Mw3MRVCB2BlRECF/CBtjuwbBwGJL1JXs474vtuU4Tkho4tyTGr9ffvfxvV93VzL/mfYPLndSumqT4buG6Y4MI3+MpyQayc/IEI/Y0DfLW8Ov725cuKYlf2iZ/p3j8FZylT4hQx1m3lvmXSL6zoYH3pZ9PzgNfi367kKA3R634t/REXF6zMa0Fh28rp8IjJjsqb/det3vUVTXp1z3T8DOs/B+kvIHw3y7/OK180Q/PUuPB2+DL/PGsrMaZQrp3tPwJEn488rhIFQ+GGNDBmTN4qht6D7nm3ESfpRBurNeXGk9Ud/3gkf9N/SnOu6UBvE1jcKBSBQBmXWanAJsH0YvGtNcWV0C6WSX6yQ/McVuQ2DNycFW6ddQkdjz6EF54xQg46MkPMfibYimXozsbn872M2PoGKKcc5tHA7IoiDHkuE7DeKGSOP04rqHcL1Klq8VqMj6dgc3jtMgx+mBFjh8DlhwpSI/BiTaR0FTwn0PHnJWiYnPNcHlLNb4uxYmU16h7Qk26+w5bWQZD9hsZmzqRBRDGJsks4JVMgIwN9M1ArIAykRrRHNMwoY1+EMtoLBhDcID05pGMsWsF1DYLPxWrepzPjWcaq2AYLPw+OFUa4MEE9jG1ox4/NoAEYUAkwNEOAJGohZIsICpAITlinCEFkCw5PEbp0GAIVZixGHZOKRzmoQlSwUgvCjESsSG3eDVJ26nMOQeHRgLQBScP0r0EvmNJJFd9onBIOtxMiH80D4MPzUeXZD4zPAseCjHy8QMTmgQqOiAQI5k+pPoayxlwaMqnOOZJXasSRenOVlfKES0JdM6PGu9qoObC5iDqw1g5oBYtIiVGLK9VRzmbgwZC2NWN0Qus/yc2iTlxmoeIRIXhRBHX5bAXrV9XlmmcH1B9DrBTf0b4i99lUEMOuku/wAAAABJRU5ErkJggg==",r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAd9JREFUOBGtVc8rRFEUPufOvELMguTHwkbKjxRlo9gqNpjyFyhTit3I8i1ldpQa5S9QmA1lS9koSn6UZmMxSCyGkPlx3O+9mTe8Zl4zw7eZ7rnn++aee893HlMRzEXFeLh6m2LJTpHwEJG022mcIJZTYbXX2lu/txnilJvO7sDkYnJaC0REqNO993PNTHEiDsfWAru/4vmFaYo6e35dEZIwYh1tPhobNmig20/NjcpKe3rJ0vlNmg5PUnR3n7FiTBwZbGpYNk3OIuCccHIhuQoxv49lNljD4yMG6VMUhT49HRynaGvnU9IZ0Wkcia0HlhxBlCkiOxAz5+u4v8tXVMgdvLjNkLnxbosyB1E+4wEeL5PXuLPQTC1NjBpunud6/yhF0e0PVBNv6Qv0KLwmxHBnKLNSgAMuNKClrNbQKniAUnfm9SfggAtAS9l9RtZrehG99tAJFnTP6n6wmzbfGl7EUnsFrrTbDVYqs4q4FtR20kDTVosClxMK3oQQHFAtHK7WUjA6hGAnOKBSgAMuAC2FqYGmhDdhp0oBDrjQgJayRxBbAwHehJ3KBXLBsfM5DC3H/v81HHIdSYQRpMcX6ekRhjcPjr/KGV+6Unt8xXJlOSfMl/lvAzYviN+/fAK+AW5jAVefzjWGAAAAAElFTkSuQmCC",l="data:image/png;base64,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",p=p||{guid:"$BAIDU$"};window[p.guid]={},p.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},p.lang=p.lang||{},p.lang.guid=function(){return"TANGRAM__"+(window[p.guid]._counter++).toString(36)},window[p.guid]._counter=window[p.guid]._counter||1,window[p.guid]._instances=window[p.guid]._instances||{},p.lang.Class=function(t){this.guid=t||p.lang.guid(),window[p.guid]._instances[this.guid]=this},window[p.guid]._instances=window[p.guid]._instances||{},p.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},p.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},p.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},p.lang.Class.prototype.dispose=function(){for(var t in delete window[p.guid]._instances[this.guid],this)p.lang.isFunction(this[t])||delete this[t];this.disposed=!0},p.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},p.lang.Class.prototype.addEventListener=function(t,e,n){if(p.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var i,a=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;e.hashCode=n,i=n}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof a[t]&&(a[t]={}),i=i||p.lang.guid(),e.hashCode=i,a[t][i]=e}},p.lang.Class.prototype.removeEventListener=function(t,e){if(p.lang.isFunction(e))e=e.hashCode;else if(!p.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][e]&&delete n[t][e]},p.lang.Class.prototype.dispatchEvent=function(t,e){for(var n in p.lang.isString(t)&&(t=new p.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{},e)t[n]=e[n];var i=this.__listeners,a=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=a.indexOf("on")&&(a="on"+a),p.lang.isFunction(this[a])&&this[a].apply(this,arguments),"object"==typeof i[a])for(n in i[a])i[a][n].apply(this,arguments);return t.returnValue},p.lang.inherits=function(t,e,n){var i,a,o=t.prototype,s=new Function;for(i in s.prototype=e.prototype,a=t.prototype=new s,o)a[i]=o[i];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof n&&(a._className=n)},p.dom=p.dom||{},p._g=p.dom._g=function(t){return p.lang.isString(t)?document.getElementById(t):t},p.g=p.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},p.insertHTML=p.dom.insertHTML=function(t,e,n){var i,a;return t=p.dom.g(t),t.insertAdjacentHTML?t.insertAdjacentHTML(e,n):(i=t.ownerDocument.createRange(),e=e.toUpperCase(),"AFTERBEGIN"==e||"BEFOREEND"==e?(i.selectNodeContents(t),i.collapse("AFTERBEGIN"==e)):(a="BEFOREBEGIN"==e,i[a?"setStartBefore":"setEndAfter"](t),i.collapse(a)),i.insertNode(i.createContextualFragment(n))),t},p.ac=p.dom.addClass=function(t,e){t=p.dom.g(t);for(var n=e.split(/\s+/),i=t.className,a=" "+i+" ",o=0,s=n.length;o<s;o++)a.indexOf(" "+n[o]+" ")<0&&(i+=(i?" ":"")+n[o]);return t.className=i,t},p.event=p.event||{},p.event._listeners=p.event._listeners||[],p.on=p.event.on=function(t,e,n){e=e.replace(/^on/i,""),t=p._g(t);var i,a=function(e){n.call(t,e)},o=p.event._listeners,s=p.event._eventFilter,r=e;return e=e.toLowerCase(),s&&s[e]&&(i=s[e](t,e,a),r=i.type,a=i.listener),t.addEventListener?t.addEventListener(r,a,!1):t.attachEvent&&t.attachEvent("on"+r,a),o[o.length]=[t,e,n,a,r],t},p.un=p.event.un=function(t,e,n){t=p._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var i,a,o,s=p.event._listeners,r=s.length,l=!n;r--;)i=s[r],i[1]!==e||i[0]!==t||!l&&i[2]!==n||(a=i[4],o=i[3],t.removeEventListener?t.removeEventListener(a,o,!1):t.detachEvent&&t.detachEvent("on"+a,o),s.splice(r,1));return t},p.getEvent=p.event.getEvent=function(t){return window.event||t},p.getTarget=p.event.getTarget=function(t){return t=p.getEvent(t),t.target||t.srcElement},p.preventDefault=p.event.preventDefault=function(t){t=p.getEvent(t),t.preventDefault?t.preventDefault():t.returnValue=!1},p.stopBubble=p.event.stopBubble=function(t){t=p.getEvent(t),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},p.browser=p.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(p.browser.ie=p.ie=document.documentMode||+RegExp.$1);var d=BMapGLLib.DrawingManager=function(t,e){t&&(h.push(this),e=e||{},this.overlays=[],this._initialize(t,e))};p.lang.inherits(d,p.lang.Class,"DrawingManager"),d.prototype.open=function(){if(1==this._isOpen)return!0;a(this),this._open()},d.prototype.close=function(){if(0==this._isOpen)return!0;var t=this;this._close(),t._map.removeOverlay(c),setTimeout(function(){t._map.enableDoubleClickZoom()},2e3)},d.prototype.setDrawingMode=function(t){this._drawingType!=t&&(a(this),this._setDrawingMode(t))},d.prototype.getDrawingMode=function(){return this._drawingType},d.prototype.enableCalculate=function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()},d.prototype.disableCalculate=function(){this._enableCalculate=!1},d.prototype.enableSorption=function(){this._enableSorption=!0},d.prototype.disableSorption=function(){this._enableSorption=!1},d.prototype.enableGpc=function(){this._enableGpc=!0,this._addGPCLibrary()},d.prototype.disableGpc=function(){this._enableGpc=!1},d.prototype.getOverlays=function(){return this.overlays},d.prototype.addOverlayData=function(t){return this.overlays.push(t)},d.prototype.setOverlaysData=function(t){return this.overlays=t},d.prototype.clearOverlayData=function(t){this._map;for(var e=0;e<this.overlays.length;e++)if(this.overlays[e]===t)return this.overlays.splice(e,1),t},d.prototype.clearOverlay=function(t){var e=this._map;t=this.clearOverlayData(t);t&&e.removeOverlay(t)},d.prototype.clearOverlays=function(){var t=this._map;this.overlays.forEach(function(e){t.removeOverlay(e)}),this.overlays.length=0},d.prototype._initialize=function(t,e){if(this._map=t,this._opts=e,this._drawingType=e.drawingMode||BMAP_DRAWING_MARKER,e.enableDrawingTool&&this.enableDrawingTool(),void 0!==e.sorptionDistance&&this.setSorptionDistance(e.sorptionDistance),!0===e.enableCalculate?this.enableCalculate():this.disableCalculate(),!0===e.enableLimit){var n=e.limitOptions;this.limit=n}!0===e.enableSorption?this.enableSorption():this.disableSorption(),!0===e.enableGpc?this.enableGpc():this.disableGpc(),this._isOpen=!(!0!==e.isOpen),this._isOpen&&this._open(),this.setPolygonOptions(e.polygonOptions),this.setMarkerOptions(e.markerOptions),this.setCircleOptions(e.circleOptions),this.setPolylineOptions(e.polylineOptions),this.setRectangleOptions(e.rectangleOptions),this.setLabelOptions(e.labelOptions),this.controlButton="right"==e.controlButton?"right":"left",this.skipEditing=void 0!==e.skipEditing&&e.skipEditing},d.prototype.enableDrawingTool=function(){var t=this._opts;if(!this._drawingTool){var e=new i(this,t.drawingToolOptions);this._drawingTool=e}this._map.addControl(this._drawingTool)},d.prototype.disableDrawingTool=function(){this._drawingTool&&this._map.removeControl(this._drawingTool)},d.prototype.setSorptionDistance=function(t){this._sorptionDistance=t||0},d.prototype.setPolygonOptions=function(t){this.polygonOptions=t||{}},d.prototype.setMarkerOptions=function(t){this.markerOptions=t||{}},d.prototype.setCircleOptions=function(t){this.circleOptions=t||{}},d.prototype.setPolylineOptions=function(t){this.polylineOptions=t||{}},d.prototype.setRectangleOptions=function(t){this.rectangleOptions=t||{}},d.prototype.setLabelOptions=function(t){this.labelOptions=t||{}},d.prototype._open=function(){this._isOpen=!0,this._mask||(this._mask=new n),this._map.addOverlay(this._mask),this._setDrawingMode(this._drawingType)},d.prototype._setDrawingMode=function(t){if(this._drawingType=t,this._isOpen)switch(this._mask.__listeners={},t){case BMAP_DRAWING_MARKER:this._bindMarker();break;case BMAP_DRAWING_CIRCLE:this._bindCircle();break;case BMAP_DRAWING_POLYLINE:case BMAP_DRAWING_POLYGON:this._bindPolylineOrPolygon();break;case BMAP_DRAWING_RECTANGLE:this._bindRectangle()}this._drawingTool&&this._isOpen&&this._drawingTool.setStyleByDrawingMode(t)},d.prototype._close=function(){this._isOpen=!1,this._mask&&this._map.removeOverlay(this._mask),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")},d.prototype._skipEditing=function(){var t=this[this._drawingType+"Options"],e=this.skipEditing,n=null;t&&(n=void 0===t.skipEditing?n:t.skipEditing),(n||e)&&!1!==n&&document.getElementById("confirmOperate").click()},d.prototype._bindMarker=function(){var t=this,e=this._map,n=this._mask,i=function(n){var i=new BMapGL.Marker(n.point,t.markerOptions);e.addOverlay(i),t._dispatchOverlayComplete(i)};n.addEventListener("click",i)};var c=null;d.prototype._bindCircle=function(){var n=this,i=this._map,a=this._mask,r=null,d=[],h=null,g=1,u=null,v=null,y=null,m=null,f={strokeColor:"#4E6DF1",strokeWeight:2},w=new BMapGL.Icon(s,new BMapGL.Size(20,20)),M=new BMapGL.Icon(l,new BMapGL.Size(40,20),{imageOffset:new BMapGL.Size(0,10)}),_=function(t){if("right"!=n.controlButton||1!=t.button&&0!=t.button){h=t.point;var e=new BMapGL.Marker(h);w.setImageSize(new BMapGL.Size(20,20)),e.setIcon(w),e.enableDragging(),e.addEventListener("dragstart",B),e.addEventListener("dragging",P),e.addEventListener("dragend",O),i.addOverlay(e),d.push(e),r=new BMapGL.Circle(h,g,n.circleOptions),i.addOverlay(r),a.enableEdgeMove(),a.addEventListener("mousemove",b),p.on(document,"mouseup",L)}},b=function(t){g=n._map.getDistance(h,t.point).toFixed(0),r.setRadius(g),i.removeOverlay(c),c=new BMapGL.Label("半径："+g+"米<br>松开完成绘制",{position:t.point,offset:new BMapGL.Size(10,10)}),c.setStyle(n.labelOptions),i.addOverlay(c)},L=function(s){var l=i.getViewport(r.getBounds());l.zoom-=1,i.setViewport(l),i.removeOverlay(c);var w=new BMapGL.Point(r.getBounds().getNorthEast().lng,h.lat);a.hide(),u=new BMapGL.Marker(w),u.setIcon(M),u.enableDragging(),v=new BMapGL.Polyline([h,w],f);var _=new BMapGL.Point((r.getBounds().getNorthEast().lng+h.lng)/2,h.lat);y=new e("circle",_,g,r,n),d=d.concat([u,v,y]);var A=null;n.limit&&(A=n.limit.area);var B={limit:A,type:"circle",point:w,overlay:r,overlays:d};m=new t(B,n),i.addOverlay(u),i.addOverlay(v),i.addOverlay(y),i.addOverlay(m),n._skipEditing(),y.addEventListener("radiuschange",function(t){var e=t.radius;r.setRadius(e);var n=o(h,e,"east"),i=new BMapGL.Point(n.lng,h.lat),a=n.lng>h.lng?(r.getBounds().getNorthEast().lng+h.lng)/2:(r.getBounds().getSouthWest().lng+h.lng)/2,s=new BMapGL.Point(a,h.lat);u.setPosition(i),y.setInfo(s,e),m.setPosition(i,!0),m.updateWindow(),v.setPath([h,i])}),u.addEventListener("dragging",function(t){var e=new BMapGL.Point(t.latLng.lng,h.lat),i=t.latLng.lng>h.lng?(r.getBounds().getNorthEast().lng+h.lng)/2:(r.getBounds().getSouthWest().lng+h.lng)/2,a=t.latLng.lng>h.lng,o=new BMapGL.Point(i,h.lat);t.target.setPosition(e),y.setInfo(o,n._map.getDistance(h,t.latLng).toFixed(0)),m.setPosition(e,a),v.setPath([h,e]),g=n._map.getDistance(h,t.latLng).toFixed(0),r.setRadius(n._map.getDistance(h,t.latLng))}),u.addEventListener("dragend",function(t){m.updateWindow()}),a.disableEdgeMove(),a.removeEventListener("mousemove",b),a.removeEventListener("mousemove",E),p.un(document,"mouseup",L),i.removeOverlay(a)},E=function(t){p.preventDefault(t),p.stopBubble(t),"right"==n.controlButton&&1==t.button||null==h&&_(t)},A=function(t){p.preventDefault(t),p.stopBubble(t),i.removeOverlay(c),c=new BMapGL.Label("按下确认中心点，拖拽确认半径",{position:t.point,offset:new BMapGL.Size(10,10)}),c.setStyle(n.labelOptions),i.addOverlay(c)},B=function(t){i.removeOverlay(u),i.removeOverlay(v),i.removeOverlay(y),i.removeOverlay(m)},P=function(t){h=t.latLng,r.setCenter(t.latLng)},O=function(t){h=t.latLng,L(t)};a.addEventListener("mousedown",E),a.addEventListener("mousemove",A)},d.prototype._bindPolylineOrPolygon=function(){function e(){for(var t=arguments[0],e=0,n=0,i=0;i<t.length;i++)e<t[i].lng&&(e=t[i].lng,n=i);return t[n]}var n=this,i=this._map,a=this._mask,o=[],s=null,r=null,l=null,d=!1,h=function(t){if("right"!==n.controlButton||1!==t.button&&0!==t.button){var e=t.point;l&&(e=l),o.push(e),s=o.concat(o[o.length-1]),1==o.length?(n._drawingType==BMAP_DRAWING_POLYLINE?r=new BMapGL.Polyline(s,n.polylineOptions):n._drawingType==BMAP_DRAWING_POLYGON&&(r=new BMapGL.Polygon(s,n.polygonOptions)),i.addOverlay(r)):r.setPath(s),d||(d=!0,a.enableEdgeMove(),a.removeEventListener("mousemove",v),a.addEventListener("mousemove",g),a.addEventListener("dblclick",u))}},g=function(t){var e=t.point;if(n._enableSorption){var a=n.getSorptionMatch(e,n.overlays,n._sorptionDistance);if(a&&a.length>0)return l=a[0].point,void r.setPositionAt(s.length-1,a[0].point)}l=null,r.setPositionAt(s.length-1,t.point),i.removeOverlay(c),c=new BMapGL.Label("单击绘制下一个点，双击完成绘制",{position:t.point,offset:new BMapGL.Size(10,10)}),c.setStyle(n.labelOptions),i.addOverlay(c)},u=function(l){p.stopBubble(l),d=!1,i.removeOverlay(c),a.disableEdgeMove(),a.removeEventListener("mousedown",h),a.removeEventListener("mousemove",g),a.removeEventListener("mousemove",v),a.removeEventListener("dblclick",u),"right"==n.controlButton?o.push(l.point):p.ie<=8||o.pop();try{if(n._enableGpc&&window.gpcas&&"polygon"===n._drawingType){for(var y=new gpcas.geometry.PolyDefault,m=0;m<o.length;m++)y.addPoint(new gpcas.Point(o[m].lng,o[m].lat));for(var f=0;f<n.overlays.length;f++){var w=n.overlays[f].getPath(),M=new gpcas.geometry.PolyDefault;for(m=0;m<w.length;m++)M.addPoint(new gpcas.Point(w[m].lng,w[m].lat));var _=y.difference(M),b=_.getPoints(),L=[];for(m=0;m<b.length;m++)L.push(new BMapGL.Point(b[m].x,b[m].y));y=new gpcas.geometry.PolyDefault;for(m=0;m<b.length;m++)y.addPoint(new gpcas.Point(b[m].x,b[m].y));o=L}}}catch(l){}r.setPath(o);var E=i.getViewport(o);E.zoom-=1,i.setViewport(E),r.enableEditing();var A=null;n.limit&&(A="polygon"===n._drawingType?n.limit.area:n.limit.distance);var B={limit:A,type:n._drawingType,point:e(o),overlay:r,overlays:[]},P=new t(B,n);i.addOverlay(P),n._skipEditing(),r.addEventListener("lineupdate",function(t){var n=e(t.currentTarget.getPath());P.setPosition(n,!0),P.updateWindow()}),o.length=0,s.length=0,i.removeOverlay(a)},v=function(t){p.preventDefault(t),p.stopBubble(t),i.removeOverlay(c),c=new BMapGL.Label("单击确认起点",{position:t.point,offset:new BMapGL.Size(10,10)}),c.setStyle(n.labelOptions),i.addOverlay(c)};a.addEventListener("mousemove",v),a.addEventListener("mousedown",h),a.addEventListener("dblclick",function(t){p.stopBubble(t)})},d.prototype._bindRectangle=function(){function n(t,e){var n=new BMapGL.Point(t.lng,t.lat),i=new BMapGL.Point(e.lng,t.lat),a=new BMapGL.Point(e.lng,e.lat),o=new BMapGL.Point(t.lng,e.lat),s=new BMapGL.Point((t.lng+e.lng)/2,t.lat),r=new BMapGL.Point(e.lng,(t.lat+e.lat)/2),l=new BMapGL.Point((t.lng+e.lng)/2,e.lat),p=new BMapGL.Point(t.lng,(t.lat+e.lat)/2);return[n,s,i,r,a,l,o,p]}var i=this,a=this._map,s=this._mask,l=null,d=null,h=new BMapGL.Icon(r,new BMapGL.Size(10,10));h.setImageSize(new BMapGL.Size(10,10));var g=function(t){if(p.stopBubble(t),p.preventDefault(t),"right"!=i.controlButton||1!=t.button&&0!=t.button){d=t.point;var e=d;l=new BMapGL.Polygon(i._getRectanglePoint(d,e),i.rectangleOptions),a.addOverlay(l),s.enableEdgeMove(),s.addEventListener("mousemove",u),p.on(document,"mouseup",v)}},u=function(t){a.removeOverlay(c),l.setPath(i._getRectanglePoint(d,t.point));var e=n(d,t.point),o=i._map.getDistance(d,e[2]).toFixed(0),s=i._map.getDistance(d,e[6]).toFixed(0);c=new BMapGL.Label("尺寸："+o+"米 x "+s+"米<br>松开结束绘制",{position:t.point,offset:new BMapGL.Size(10,10)}),c.setStyle(i.labelOptions),a.addOverlay(c)},v=function(r){s.hide();var g=null,m=[],f=n(d,r.point),w=[],M=a.getViewport(f);M.zoom-=1,a.setViewport(M),a.removeOverlay(c);for(var _=i._map.getDistance(d,f[2]).toFixed(0),b=i._map.getDistance(d,f[6]).toFixed(0),L=new e("rectangle",f[0],{width:_,height:b},l,i),E=0;E<f.length;E++){var A=new BMapGL.Marker(f[E]);A.setIcon(h),A.enableDragging(),m.push(A),a.addOverlay(A),w[E]=i.mc2ll(A.point),A.addEventListener("mousedown",function(t){g=i.mc2ll(t.target.point)}),A.addEventListener("dragging",function(t){for(var e=t.latLng,a=0;a<w.length;a++)g.lng==w[a].lng&&(f[a].lng=e.lng),g.lat==w[a].lat&&(f[a].lat=e.lat);f=n(f[0],f[4]);for(a=0;a<m.length;a++)m[a].setPosition(f[a]);_=i._map.getDistance(f[0],f[2]).toFixed(0),b=i._map.getDistance(f[0],f[6]).toFixed(0),L.setInfo(f[0],{width:_,height:b}),G.setPosition(f[3],!0),l.setPath(f)}),A.addEventListener("dragend",function(t){for(var e=0;e<m.length;e++){var n=m[e];w[e]=i.mc2ll(n.point)}G.updateWindow()})}L.addEventListener("rectwhchange",function(t){var e=t.width,a=t.height,s=o(f[0],e,"east"),r=o(f[0],a,"south");f[4].lng=s.lng,f[4].lat=r.lat,f=n(f[0],f[4]);for(var p=0;p<m.length;p++)m[p].setPosition(f[p]);L.setInfo(f[0],{width:e,height:a}),G.setPosition(f[3],!0),l.setPath(f);for(var d=0;d<m.length;d++){var c=m[d];w[d]=i.mc2ll(c.point)}G.updateWindow()});var B=[m,L],P=null;i.limit&&(P=i.limit.area);var O={limit:P,type:"rectangle",point:f[3],overlay:l,overlays:B},G=new t(O,i);a.addOverlay(G),a.addOverlay(L),s.disableEdgeMove(),s.removeEventListener("mousemove",u),s.removeEventListener("mousemove",y),i._skipEditing(),p.un(document,"mouseup",v),a.removeOverlay(s)},y=function(t){p.preventDefault(t),p.stopBubble(t),a.removeOverlay(c),c=new BMapGL.Label("按住确认起点，拖拽进行绘制",{position:t.point,offset:new BMapGL.Size(10,10)}),c.setStyle(i.labelOptions),a.addOverlay(c)};s.addEventListener("mousedown",g),s.addEventListener("mousemove",y)},d.prototype._calculate=function(t,e){var n={data:0,label:null};if(this._enableCalculate&&BMapGLLib.GeoUtils){var i=t.toString();switch(i){case"Polyline":n.data=BMapGLLib.GeoUtils.getPolylineDistance(t);break;case"Polygon":n.data=BMapGLLib.GeoUtils.getTurfPolygonArea(t);break;case"Circle":var a=t.getRadius();n.data=Math.PI*a*a}!n.data||n.data<0?n.data=0:n.data=n.data.toFixed(2)}return n},d.prototype._addGeoUtilsLibrary=function(){if(!BMapGLLib.GeoUtils){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","./turf.min.js"),document.body.appendChild(t);var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","./GeoUtils.js"),document.body.appendChild(e)}},d.prototype._addGPCLibrary=function(){if(!window.gpcas){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","//mapopen.cdn.bcebos.com/github/BMapGLLib/DrawingManager/src/gpc.js"),document.body.appendChild(t)}},d.prototype._addLabel=function(t,e){var n=new BMapGL.Label(e,{position:t});return this._map.addOverlay(n),n},d.prototype._getRectanglePoint=function(t,e){return[new BMapGL.Point(t.lng,t.lat),new BMapGL.Point(e.lng,t.lat),new BMapGL.Point(e.lng,e.lat),new BMapGL.Point(t.lng,e.lat)]},d.prototype._dispatchOverlayComplete=function(t,e){var n={overlay:t,drawingMode:this._drawingType};e&&(n.calculate=e.data||null,n.label=e.label||null),this.dispatchEvent(this._drawingType+"complete",t),this.dispatchEvent("overlaycomplete",n)},d.prototype._dispatchOverlayCancel=function(t){var e={overlay:t,drawingMode:this._drawingType};this.dispatchEvent(this._drawingType+"cancel",t),this.dispatchEvent("overlaycancel",e)},d.prototype.getSorptionMatch=function(t,e,n){n=n||20;for(var i=this._map,a=i.pointToPixel(t),o=[],s=0;s<e.length;s++){var r=e[s].getPath(),l=r[0],p=r[r.length-1];l.equals(p)||r.push(r[0]);for(var d=1;d<r.length;d++){var c=i.pointToPixel(r[d-1]),h=i.pointToPixel(r[d]),g=[a.x-c.x,a.y-c.y],u=[h.x-c.x,h.y-c.y],v=[h.x-a.x,h.y-a.y],y=g[0]*u[0]+g[1]*u[1],m=Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2))*Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2)),f=Math.acos(y/m),w=u[0]*v[0]+u[1]*v[1],M=Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2))*Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2)),_=Math.acos(w/M);if(f<Math.PI/2&&_<Math.PI/2){var b=Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2)),L=Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2)),E=Math.cos(f)*b,A=E/L,B=Math.sin(f)*b,P=[c.x+u[0]*A,c.y+u[1]*A];B<n&&o.push({point:i.pixelToPoint({x:P[0],y:P[1]}),length:B})}}}o.sort(function(t,e){return t.length-e.length});var O=o.length>0?o:null;return O},d.prototype.mc2ll=function(t){var e=this._map,n=e.mercatorToLnglat(t.lng,t.lat);return new BMapGL.Point(n[0],n[1])},d.prototype.ll2mc=function(t){var e=this._map,n=e.lnglatToMercator(t.lng,t.lat);return new BMapGL.Point(n[0],n[1])},t.prototype=new BMapGL.Overlay,t.prototype.dispatchEvent=p.lang.Class.prototype.dispatchEvent,t.prototype.addEventListener=p.lang.Class.prototype.addEventListener,t.prototype.removeEventListener=p.lang.Class.prototype.removeEventListener,t.prototype.initialize=function(t){this._map=t;var e="polyline"===this.type?"长度":"面积",n="polyline"===this.type?"万米":"万平方米",i=this.div=document.createElement("div");i.className="operateWindow";var a='<div><span id="confirmOperate"></span><span id="cancelOperate"></span><span id="warnOperate">'+e+"不超过"+this.limit/1e4+n+"！</span></div>";return i.innerHTML=a,this._map.getPanes().markerPane.appendChild(i),this.updateWindow(),this._bind(),i},t.prototype._bind=function(){var t=this,e=this._map,n=this.overlay,i=this.overlays;document.getElementById("confirmOperate").addEventListener("click",function(a){if(e.removeOverlay(t),"rectangle"==t.type){var o=t.DrawingManager._calculate(n,n.getPath());t.DrawingManager.overlays.push(n)}else if("circle"==t.type){o=t.DrawingManager._calculate(n,t.point);t.DrawingManager.overlays.push(n)}else if("polygon"==t.type){o=t.DrawingManager._calculate(n,n.getPath());t.DrawingManager.overlays.push(n),n.disableEditing()}else if("polyline"==t.type){o=t.DrawingManager._calculate(n,n.getPath());t.DrawingManager.overlays.push(n),n.disableEditing()}t.DrawingManager._dispatchOverlayComplete(n,o);for(var s=0;s<i.length;s++)if(Array.isArray(i[s]))for(var r in i[s])e.removeOverlay(i[s][r]);else e.removeOverlay(i[s]);t.DrawingManager.close()}),document.getElementById("cancelOperate").addEventListener("click",function(a){e.removeOverlay(t);for(var o=0;o<i.length;o++)if(Array.isArray(i[o]))for(var s in i[o])e.removeOverlay(i[o][s]);else e.removeOverlay(i[o]);e.removeOverlay(n),t.DrawingManager._dispatchOverlayCancel(n),t.DrawingManager.close()})},t.prototype.updateWindow=function(){if(null!==this.domElement){var t,e=this.overlay,n=this.limit;"rectangle"==this.type?t=this.DrawingManager._calculate(e,e.getPath()):"circle"==this.type?t=this.DrawingManager._calculate(e,this.point):"polygon"==this.type?t=this.DrawingManager._calculate(e,e.getPath()):"polyline"==this.type&&(t=this.DrawingManager._calculate(e,e.getPath())),"[object Number]"===Object.prototype.toString.call(n)&&t.data>n?(document.getElementById("confirmOperate").style.display="none",document.getElementById("warnOperate").style.display="block"):(document.getElementById("confirmOperate").style.display="block",document.getElementById("warnOperate").style.display="none")}},t.prototype.setPosition=function(t,e){this.point=t;var n=this._map,i=n.pointToOverlayPixel(this.point);e?(this.div.classList.remove("operateLeft"),this.div.style.left=i.x+15+"px"):(this.div.classList.add("operateLeft"),this.div.style.left=i.x-105+"px"),this.div.style.top=i.y-16+"px"},t.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this.point);this.div.style.left=e.x+15+"px",this.div.style.top=e.y-16+"px"},e.prototype=new BMapGL.Overlay,e.prototype.dispatchEvent=p.lang.Class.prototype.dispatchEvent,e.prototype.addEventListener=p.lang.Class.prototype.addEventListener,e.prototype.removeEventListener=p.lang.Class.prototype.removeEventListener,e.prototype.initialize=function(t){this._map=t;var e=this.div=document.createElement("div");if(e.className="screenshot","circle"==this.type)var n='<div class="circlShot"><span id="screenshotNum">'+this.number+'</span><input id="circleInput" type="text" /><span class="unit">米</span></div>';else if("rectangle"==this.type)n='<div class="rectWH"><div class="wh"><span id="rectWidth">'+this.number.width+'</span><input id="rectWidthInput" type="text" /></div><span class="multiple">x</span><div class="wh"><span id="rectHeight">'+this.number.height+'</span><input id="rectHeightInput" type="text" /></div><span class="unit">米</span></div>';return e.innerHTML=n,this._map.getPanes().markerPane.appendChild(e),this._bind(),e},e.prototype._bind=function(){this.setNumber(this.number),"circle"==this.type?this.bindCircleEvent():this.bindRectEvent()},e.prototype.bindCircleEvent=function(){var t=this,e=document.getElementById("screenshotNum"),n=document.getElementById("circleInput");e.addEventListener("click",function(t){var i=e.innerText;e.style.display="none",n.value=i,n.style.display="inline-block",n.focus()}),n.addEventListener("click",function(t){n.focus()}),n.addEventListener("keydown",function(i){if(13===i.keyCode){var a=n.value;n.style.display="none",e.style.display="inline-block",e.innerText=a;var o={radius:a,overlay:t.overlay};t._dispatchRadiusChange(o)}}),n.addEventListener("blur",function(i){var a=n.value;n.style.display="none",e.style.display="inline-block",e.innerText=a;var o={radius:a,overlay:t.overlay};t._dispatchRadiusChange(o)})},e.prototype.bindRectEvent=function(){var t=this,e=document.getElementById("rectWidth"),n=document.getElementById("rectWidthInput"),i=document.getElementById("rectHeight"),a=document.getElementById("rectHeightInput");n.value=e.innerText,a.value=i.innerText,e.addEventListener("click",function(t){var i=e.innerText;e.style.display="none",n.value=i,n.style.display="inline-block",n.focus()}),i.addEventListener("click",function(t){var e=i.innerText;i.style.display="none",a.value=e,a.style.display="inline-block",a.focus()}),n.addEventListener("click",function(t){n.focus()}),a.addEventListener("click",function(t){a.focus()}),n.addEventListener("keydown",function(o){if(13===o.keyCode){var s=n.value,r=a.value;n.style.display="none",a.style.display="none",e.style.display="inline-block",i.style.display="inline-block",e.innerText=s,i.innerText=r;var l={width:s,height:r,overlay:t.overlay};t._dispatchRectWHChange(l)}}),a.addEventListener("keydown",function(o){if(13===o.keyCode){var s=n.value,r=a.value;n.style.display="none",a.style.display="none",e.style.display="inline-block",i.style.display="inline-block",e.innerText=s,i.innerText=r;var l={width:s,height:r,overlay:t.overlay};t._dispatchRectWHChange(l)}})},e.prototype.setInfo=function(t,e){this.setNumber(e),this.setPosition(t)},
e.prototype.setNumber=function(t){"circle"==this.type?document.getElementById("screenshotNum").textContent=t:(document.getElementById("rectWidth").textContent=t.width,document.getElementById("rectHeight").textContent=t.height)},e.prototype.setPosition=function(t){this.point=t;var e=this._map,n=this.type,i=e.pointToOverlayPixel(this.point);"circle"==n?(this.div.style.left=i.x-30+"px",this.div.style.top=i.y-40+"px"):"rectangle"==n&&(this.div.style.left=i.x+"px",this.div.style.top=i.y-45+"px")},e.prototype.draw=function(){var t=this._map,e=this.type,n=t.pointToOverlayPixel(this.point);"circle"==e?(this.div.style.left=n.x-30+"px",this.div.style.top=n.y-40+"px"):"rectangle"==e&&(this.div.style.left=n.x+"px",this.div.style.top=n.y-45+"px")},e.prototype._dispatchRadiusChange=function(t){this.dispatchEvent("radiuschange",t)},e.prototype._dispatchRectWHChange=function(t){this.dispatchEvent("rectwhchange",t)},n.prototype=new BMapGL.Overlay,n.prototype.dispatchEvent=p.lang.Class.prototype.dispatchEvent,n.prototype.addEventListener=p.lang.Class.prototype.addEventListener,n.prototype.removeEventListener=p.lang.Class.prototype.removeEventListener,n.prototype.initialize=function(t){var e=this;this._map=t;var n=this.container=document.createElement("div"),i=this._map.getSize();return n.style.cssText="position:absolute;background:transparent;cursor:crosshair;width:"+i.width+"px;height:"+i.height+"px",this._map.addEventListener("resize",function(t){e._adjustSize(t.size)}),this._map.getPanes().floatPane.appendChild(n),this._bind(),n},n.prototype.draw=function(){var t=this._map,e=t.pixelToPoint(new BMapGL.Pixel(0,0)),n=t.pointToOverlayPixel(e);this.container.style.left=n.x+"px",this.container.style.top=n.y+"px"},n.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},n.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},n.prototype._bind=function(){for(var t=this,e=(this._map,this.container),n=null,i=null,a=function(t){return{x:t.clientX,y:t.clientY}},o=function(e){var o=e.type;e=p.getEvent(e),point=t.getDrawPoint(e);var s=function(n){e.point=point,t.dispatchEvent(e)};"mousedown"==o&&(n=a(e));var r=a(e);"click"==o?Math.abs(r.x-n.x)<5&&Math.abs(r.y-n.y)<5&&(i&&Math.abs(r.x-i.x)<5&&Math.abs(r.y-i.y)<5?i=null:(s("click"),i=a(e))):s(o)},s=["click","mousedown","mousemove","mouseup","dblclick"],r=s.length;r--;)p.on(e,s[r],o);p.on(e,"mousemove",function(e){t._enableEdgeMove&&t.mousemoveAction(e)})},n.prototype.mousemoveAction=function(t){function e(t){var e=t.clientX,n=t.clientY;return t.changedTouches&&(e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY),new BMapGL.Pixel(e,n)}var n=this._map,i=this,a=n.pointToPixel(this.getDrawPoint(t)),o=e(t),s=o.x-a.x,r=o.y-a.y;a=new BMapGL.Pixel(o.x-s,o.y-r),this._draggingMovePixel=a;n.pixelToPoint(a);this._panByX=this._panByY=0,a.x<=20||a.x>=n.width-20||a.y<=50||a.y>=n.height-10?(a.x<=20?this._panByX=8:a.x>=n.width-20&&(this._panByX=-8),a.y<=50?this._panByY=8:a.y>=n.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval(function(){n.panBy(i._panByX,i._panByY,{noAnimation:!0})},30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},n.prototype._adjustSize=function(t){this.container.style.width=t.width+"px",this.container.style.height=t.height+"px"},n.prototype.getDrawPoint=function(t){var e=this._map,n=p.getTarget(t),i=t.offsetX||t.layerX||0,a=t.offsetY||t.layerY||0;for(1!=n.nodeType&&(n=n.parentNode);n&&n!=e.getContainer();)0==n.clientWidth&&0==n.clientHeight&&n.offsetParent&&"TD"==n.offsetParent.nodeName||(i+=n.offsetLeft||0,a+=n.offsetTop||0),n=n.offsetParent;var o=new BMapGL.Pixel(i,a),s=e.pixelToPoint(o);return s},i.prototype=new BMapGL.Control,i.prototype.initialize=function(t){var e=this.container=document.createElement("div");e.className="BMapGLLib_Drawing";var n=this.panel=document.createElement("div");n.className="BMapGLLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.hasCustomStyle&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),e.appendChild(n);var i=this._generalHtml();n.appendChild(i);var a=this.tip=document.createElement("div");return a.className="BMapGLLib_tip",a.innerHTML='<p class="BMapGLLib_tip_title"></p><p class="BMapGLLib_tip_text"></p>',!0===this.drawingToolOptions.enableTips&&n.appendChild(a),this._bind(n),this.drawingToolOptions.customContainer?p.g(this.drawingToolOptions.customContainer).appendChild(e):t.getContainer().appendChild(e),e},i.prototype._generalHtml=function(t){var e=this,n={hander:"拖动地图"};n[BMAP_DRAWING_MARKER]="画点",n[BMAP_DRAWING_CIRCLE]="圆形工具",n[BMAP_DRAWING_POLYLINE]="画折线",n[BMAP_DRAWING_POLYGON]="多边形工具",n[BMAP_DRAWING_RECTANGLE]="矩形工具";for(var i=function(t,i){var a=document.createElement("a");return a.className=t,a.href="javascript:void(0)",a.setAttribute("drawingType",i),a.setAttribute("onfocus","this.blur()"),a.addEventListener("mouseenter",function(t){var i=t.target.getAttribute("drawingType"),a=n[i];"hander"===i?(e.tip.children[0].innerText=a,e.tip.children[1].innerText="使用鼠标拖动地图"):(e.tip.className+=" "+i,e.tip.children[0].innerText=a,e.tip.children[1].innerText="使用"+a+"选出目标区域"),e.tip.style.display="block"}),a.addEventListener("mouseleave",function(t){for(var n=t.target.getAttribute("drawingType"),i=" "+e.tip.className.replace(/[\t\r\n]/g,"")+" ";i.indexOf(" "+n+" ")>=0;)i=i.replace(" "+n+" "," ");e.tip.className=i.replace(/^\s+|\s+$/g,""),e.tip.style.display="none"}),a},a=document.createDocumentFragment(),o=0,s=this.drawingModes.length;o<s;o++){var r="BMapGLLib_box BMapGLLib_"+this.drawingModes[o];o==s-1&&(r+=" BMapGLLib_last"),a.appendChild(i(r,this.drawingModes[o]))}return a},i.prototype._setScale=function(t){var e=390,n=50,i=-parseInt((e-e*t)/2,10),a=-parseInt((n-n*t)/2,10);this.container.style.cssText=["-moz-transform: scale("+t+");","-o-transform: scale("+t+");","-webkit-transform: scale("+t+");","transform: scale("+t+");","margin-left:"+i+"px;","margin-top:"+a+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+t+",","M12=0,","M21=0,","M22="+t+",","SizingMethod='auto expand');"].join("")},i.prototype._bind=function(t){var e=this;p.on(this.panel,"click",function(t){var n=p.getTarget(t),i=n.getAttribute("drawingType");e.setStyleByDrawingMode(i),e._bindEventByDraingMode(i)})},i.prototype.setStyleByDrawingMode=function(t){if(t)for(var e=this.panel.getElementsByTagName("a"),n=0,i=e.length;n<i;n++){var a=e[n];if(a.getAttribute("drawingType")==t){var o="BMapGLLib_box BMapGLLib_"+t+"_hover";n==i-1&&(o+=" BMapGLLib_last"),a.className=o}else a.className=a.className.replace(/_hover/,"")}},i.prototype._bindEventByDraingMode=function(t){var e=this.drawingManager;e._isOpen&&e.getDrawingMode()===t?(e.close(),e._map.enableDoubleClickZoom()):(e.setDrawingMode(t),e.open(),e._map.disableDoubleClickZoom())};var h=[]})();